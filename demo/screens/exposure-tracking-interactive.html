<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EDC Exposure Tracking - Sakhi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            min-height: 100vh;
            padding: 20px 0;
        }
        .container {
            max-width: 1400px;
        }
        .module-header {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            text-align: center;
        }
        .exposure-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        .btn-back {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            text-decoration: none;
            display: inline-block;
            margin-bottom: 20px;
        }
        .btn-back:hover {
            color: white;
            transform: translateY(-2px);
        }
        .exposure-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #ef4444;
        }
        .exposure-item.safe {
            border-left-color: #10b981;
            background: #f0fdf4;
        }
        .exposure-item.warning {
            border-left-color: #f59e0b;
            background: #fffbeb;
        }
        .exposure-item.danger {
            border-left-color: #ef4444;
            background: #fef2f2;
        }
        .exposure-bar {
            width: 100%;
            height: 12px;
            background: #e5e7eb;
            border-radius: 6px;
            overflow: hidden;
            margin: 10px 0;
        }
        .exposure-fill {
            height: 100%;
            border-radius: 6px;
            transition: width 0.5s ease;
        }
        .exposure-fill.safe { background: #10b981; }
        .exposure-fill.warning { background: #f59e0b; }
        .exposure-fill.danger { background: #ef4444; }
        .product-log {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-left: 3px solid #ef4444;
        }
        .add-exposure-form {
            background: #fef2f2;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .alert-banner {
            background: linear-gradient(135deg, #fee2e2, #fecaca);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #ef4444;
        }
        .edc-badge {
            font-size: 0.9rem;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: bold;
        }
        .edc-safe { background: #d1fae5; color: #065f46; }
        .edc-warning { background: #fef3c7; color: #92400e; }
        .edc-danger { background: #fee2e2; color: #991b1b; }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="btn-back">
            <i class="fas fa-arrow-left"></i> Back to Hub
        </a>
        
        <div class="module-header">
            <div class="mb-4">
                <i class="fas fa-chart-line fa-4x text-danger"></i>
            </div>
            <h1>EDC Exposure Tracking <span class="badge bg-success">INTERACTIVE</span></h1>
            <p class="lead">Monitor cumulative exposure to harmful chemicals and compare against EPA safe limits</p>
        </div>

        <div class="row">
            <div class="col-lg-8">
                <div id="alertBanner" class="alert-banner" style="display: none;">
                    <h5><i class="fas fa-exclamation-triangle text-danger"></i> High Exposure Alert</h5>
                    <p id="alertMessage">--</p>
                </div>

                <div class="exposure-card">
                    <h3><i class="fas fa-chart-bar text-primary"></i> Current Exposure Levels</h3>
                    <div id="exposureLevels">
                        <!-- Exposure levels will be loaded here -->
                    </div>
                </div>

                <div class="add-exposure-form">
                    <h4><i class="fas fa-plus-circle text-danger"></i> Log Product Usage</h4>
                    <div class="row">
                        <div class="col-md-4">
                            <label class="form-label">Product Category</label>
                            <select class="form-select" id="categorySelect">
                                <option value="cosmetics">Cosmetics</option>
                                <option value="cleaning">Cleaning Products</option>
                                <option value="personal-care">Personal Care</option>
                                <option value="food-packaging">Food Packaging</option>
                                <option value="textiles">Textiles</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Product Name</label>
                            <input type="text" class="form-control" id="productInput" placeholder="Enter product name">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Usage Frequency</label>
                            <select class="form-select" id="frequencySelect">
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                                <option value="occasional">Occasional</option>
                            </select>
                        </div>
                    </div>
                    <div class="text-center mt-3">
                        <button class="btn btn-danger" onclick="addExposure()">
                            <i class="fas fa-plus"></i> Log Exposure
                        </button>
                        <button class="btn btn-outline-primary" onclick="generateSampleData()">
                            <i class="fas fa-magic"></i> Load Sample Data
                        </button>
                    </div>
                </div>

                <div class="chart-container">
                    <h4><i class="fas fa-chart-area text-info"></i> Monthly Exposure Trends</h4>
                    <canvas id="exposureChart" width="400" height="200"></canvas>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="exposure-card">
                    <h4><i class="fas fa-history text-warning"></i> Recent Exposures</h4>
                    <div id="recentExposures">
                        <!-- Recent exposures will be loaded here -->
                    </div>
                </div>

                <div class="exposure-card">
                    <h4><i class="fas fa-shield-alt text-success"></i> Reduction Tips</h4>
                    <div id="reductionTips">
                        <div class="mb-3">
                            <strong><i class="fas fa-leaf text-success"></i> Choose Natural Products</strong>
                            <p class="text-muted small">Opt for products with fewer synthetic chemicals</p>
                        </div>
                        <div class="mb-3">
                            <strong><i class="fas fa-recycle text-info"></i> Reduce Plastic Use</strong>
                            <p class="text-muted small">Use glass or steel containers for food storage</p>
                        </div>
                        <div class="mb-3">
                            <strong><i class="fas fa-home text-warning"></i> Improve Ventilation</strong>
                            <p class="text-muted small">Ensure good air circulation at home</p>
                        </div>
                    </div>
                </div>

                <div class="exposure-card">
                    <h4><i class="fas fa-chart-pie text-primary"></i> Quick Stats</h4>
                    <div class="row text-center">
                        <div class="col-6">
                            <h3 class="text-danger" id="highExposureCount">0</h3>
                            <small class="text-muted">High Risk</small>
                        </div>
                        <div class="col-6">
                            <h3 class="text-success" id="safeExposureCount">0</h3>
                            <small class="text-muted">Safe Levels</small>
                        </div>
                    </div>
                    <div class="row text-center mt-3">
                        <div class="col-6">
                            <h3 class="text-info" id="totalProducts">0</h3>
                            <small class="text-muted">Products Tracked</small>
                        </div>
                        <div class="col-6">
                            <h3 class="text-warning" id="monthlyExposure">0</h3>
                            <small class="text-muted">This Month</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // EDC types and their EPA safe limits (mg/day)
        const edcTypes = {
            phthalates: { name: 'Phthalates', limit: 0.02, current: 0, unit: 'mg/day' },
            parabens: { name: 'Parabens', limit: 0.4, current: 0, unit: 'mg/day' },
            bisphenol_a: { name: 'Bisphenol A (BPA)', limit: 0.05, current: 0, unit: 'mg/day' },
            triclosan: { name: 'Triclosan', limit: 0.03, current: 0, unit: 'mg/day' },
            formaldehyde: { name: 'Formaldehyde', limit: 0.15, current: 0, unit: 'mg/day' },
            heavy_metals: { name: 'Heavy Metals', limit: 0.01, current: 0, unit: 'mg/day' }
        };

        let exposureLog = [];
        let exposureChart = null;

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            generateSampleData();
        });

        function generateSampleData() {
            // Reset current exposure levels
            Object.keys(edcTypes).forEach(key => {
                edcTypes[key].current = 0;
            });

            // Generate sample exposure data
            exposureLog = [
                { date: '2024-02-15', product: 'Daily Moisturizer', category: 'cosmetics', edcs: { parabens: 0.05, phthalates: 0.003 } },
                { date: '2024-02-16', product: 'Shampoo', category: 'personal-care', edcs: { parabens: 0.08, formaldehyde: 0.02 } },
                { date: '2024-02-17', product: 'Plastic Food Container', category: 'food-packaging', edcs: { bisphenol_a: 0.012 } },
                { date: '2024-02-18', product: 'Antibacterial Soap', category: 'personal-care', edcs: { triclosan: 0.025 } },
                { date: '2024-02-19', product: 'Lipstick', category: 'cosmetics', edcs: { heavy_metals: 0.008, parabens: 0.03 } },
                { date: '2024-02-20', product: 'All-Purpose Cleaner', category: 'cleaning', edcs: { formaldehyde: 0.045, phthalates: 0.008 } }
            ];

            // Calculate current exposure levels
            exposureLog.forEach(entry => {
                Object.keys(entry.edcs).forEach(edc => {
                    if (edcTypes[edc]) {
                        edcTypes[edc].current += entry.edcs[edc];
                    }
                });
            });

            updateDisplay();
        }

        function addExposure() {
            const category = document.getElementById('categorySelect').value;
            const product = document.getElementById('productInput').value;
            const frequency = document.getElementById('frequencySelect').value;

            if (!product) {
                alert('Please enter a product name');
                return;
            }

            // Simulate EDC detection based on category
            const edcProfiles = {
                cosmetics: { parabens: 0.04, heavy_metals: 0.005 },
                cleaning: { formaldehyde: 0.03, phthalates: 0.006 },
                'personal-care': { parabens: 0.06, triclosan: 0.015 },
                'food-packaging': { bisphenol_a: 0.01, phthalates: 0.004 },
                textiles: { formaldehyde: 0.02, heavy_metals: 0.003 }
            };

            const frequencyMultiplier = {
                daily: 1.0,
                weekly: 0.14,
                monthly: 0.033,
                occasional: 0.01
            };

            const baseEdcs = edcProfiles[category] || { phthalates: 0.005 };
            const multiplier = frequencyMultiplier[frequency];
            const adjustedEdcs = {};

            Object.keys(baseEdcs).forEach(edc => {
                adjustedEdcs[edc] = baseEdcs[edc] * multiplier;
                if (edcTypes[edc]) {
                    edcTypes[edc].current += adjustedEdcs[edc];
                }
            });

            exposureLog.push({
                date: new Date().toISOString().split('T')[0],
                product,
                category,
                edcs: adjustedEdcs
            });

            // Clear form
            document.getElementById('productInput').value = '';

            updateDisplay();
            
            // Show success message
            alert(`âœ… Exposure logged successfully!\n\nProduct: ${product}\nCategory: ${category}\nFrequency: ${frequency}\n\nEDCs detected: ${Object.keys(adjustedEdcs).join(', ')}`);
        }

        function updateDisplay() {
            displayExposureLevels();
            displayRecentExposures();
            updateStats();
            updateChart();
            checkAlerts();
        }

        function displayExposureLevels() {
            const container = document.getElementById('exposureLevels');
            
            container.innerHTML = Object.keys(edcTypes).map(key => {
                const edc = edcTypes[key];
                const percentage = Math.min((edc.current / edc.limit) * 100, 100);
                const status = getExposureStatus(edc.current, edc.limit);

                return `
                    <div class="exposure-item ${status}">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h5 class="mb-0">${edc.name}</h5>
                            <span class="edc-badge edc-${status}">${status.toUpperCase()}</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Current: ${edc.current.toFixed(3)} ${edc.unit}</span>
                            <span class="text-muted">EPA Limit: ${edc.limit} ${edc.unit}</span>
                        </div>
                        <div class="exposure-bar">
                            <div class="exposure-fill ${status}" style="width: ${percentage}%"></div>
                        </div>
                        <small class="text-muted">
                            ${percentage.toFixed(1)}% of EPA safe limit
                        </small>
                    </div>
                `;
            }).join('');
        }

        function getExposureStatus(current, limit) {
            const ratio = current / limit;
            if (ratio >= 0.8) return 'danger';
            if (ratio >= 0.5) return 'warning';
            return 'safe';
        }

        function displayRecentExposures() {
            const container = document.getElementById('recentExposures');
            const recent = exposureLog.slice(-5).reverse();
            
            if (recent.length === 0) {
                container.innerHTML = '<p class="text-muted text-center">No exposures logged yet</p>';
                return;
            }

            container.innerHTML = recent.map(entry => `
                <div class="product-log">
                    <div class="d-flex justify-content-between align-items-center mb-1">
                        <strong>${entry.product}</strong>
                        <small class="text-muted">${entry.date}</small>
                    </div>
                    <div class="mb-2">
                        <span class="badge bg-light text-dark">${entry.category}</span>
                    </div>
                    <div>
                        <strong>EDCs:</strong> ${Object.keys(entry.edcs).join(', ')}
                    </div>
                </div>
            `).join('');
        }

        function updateStats() {
            let highExposureCount = 0;
            let safeExposureCount = 0;
            let totalProducts = exposureLog.length;
            let monthlyExposure = 0;

            Object.keys(edcTypes).forEach(key => {
                const edc = edcTypes[key];
                const status = getExposureStatus(edc.current, edc.limit);
                
                if (status === 'danger') {
                    highExposureCount++;
                } else if (status === 'safe') {
                    safeExposureCount++;
                }

                monthlyExposure += edc.current;
            });

            document.getElementById('highExposureCount').textContent = highExposureCount;
            document.getElementById('safeExposureCount').textContent = safeExposureCount;
            document.getElementById('totalProducts').textContent = totalProducts;
            document.getElementById('monthlyExposure').textContent = monthlyExposure.toFixed(2);
        }

        function updateChart() {
            const ctx = document.getElementById('exposureChart').getContext('2d');
            
            if (exposureChart) {
                exposureChart.destroy();
            }

            // Prepare data for chart
            const labels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
            const datasets = Object.keys(edcTypes).map((key, index) => {
                const colors = ['#ef4444', '#f59e0b', '#8b5cf6', '#06b6d4', '#10b981', '#f97316'];
                return {
                    label: edcTypes[key].name,
                    data: [
                        Math.random() * edcTypes[key].current * 0.3,
                        Math.random() * edcTypes[key].current * 0.5,
                        Math.random() * edcTypes[key].current * 0.8,
                        edcTypes[key].current
                    ],
                    borderColor: colors[index % colors.length],
                    backgroundColor: colors[index % colors.length] + '20',
                    tension: 0.4
                };
            });

            exposureChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels,
                    datasets
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'EDC Exposure Trends (mg/day)'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function checkAlerts() {
            const alertBanner = document.getElementById('alertBanner');
            const alertMessage = document.getElementById('alertMessage');
            
            const highExposures = [];
            Object.keys(edcTypes).forEach(key => {
                const edc = edcTypes[key];
                if (edc.current >= edc.limit * 0.8) {
                    highExposures.push(edc.name);
                }
            });

            if (highExposures.length > 0) {
                alertBanner.style.display = 'block';
                alertMessage.textContent = `High exposure detected for: ${highExposures.join(', ')}. Consider reducing usage of products containing these chemicals.`;
            } else {
                alertBanner.style.display = 'none';
            }
        }
    </script>
</body>
</html>