<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PPD Risk Prediction | Sakhi - Women's Health Companion</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            min-height: 100vh;
        }
        .navbar {
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
        }
        .content {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
        }
        .calculator-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }
        .result-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            text-align: center;
        }
        .risk-score {
            font-size: 5rem;
            font-weight: bold;
            margin: 30px 0;
            transition: all 0.5s;
        }
        .risk-low { color: #10b981; }
        .risk-moderate { color: #3b82f6; }
        .risk-high { color: #f59e0b; }
        .risk-critical { color: #ef4444; }
        .slider-container {
            margin: 25px 0;
        }
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: 600;
        }
        .slider-value {
            background: #f59e0b;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 1.1rem;
        }
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #e5e7eb;
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #f59e0b;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .recommendation-card {
            background: #f8f9fa;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }
        .chart-container {
            position: relative;
            height: 350px;
            margin: 30px 0;
        }
        .btn-calculate {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            border: none;
            padding: 15px 50px;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }
        .btn-calculate:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
        }
        .factor-weight {
            font-size: 0.85rem;
            color: #6b7280;
            font-style: italic;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="../index.html">
                <i class="fas fa-arrow-left"></i> Back to Modules
            </a>
            <span class="navbar-text text-white">
                <i class="fas fa-brain"></i> Sakhi PPD Risk Prediction AI
            </span>
        </div>
    </nav>

    <div class="content">
        <div class="row">
            <div class="col-lg-6">
                <div class="calculator-card">
                    <h2 class="mb-4"><i class="fas fa-calculator"></i> Risk Assessment Calculator</h2>
                    <p class="text-muted mb-4">Adjust the sliders below to calculate PPD risk score using our 5-factor AI model (79% accuracy)</p>
                    
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>EPDS Score (0-30) <span class="factor-weight">Weight: 30%</span></span>
                            <span class="slider-value" id="epdsValue">15</span>
                        </div>
                        <input type="range" min="0" max="30" value="15" id="epdsSlider" oninput="updateCalculator()">
                        <small class="text-muted">Edinburgh Postnatal Depression Scale score</small>
                    </div>

                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Hormonal Risk (0-100) <span class="factor-weight">Weight: 25%</span></span>
                            <span class="slider-value" id="hormonalValue">60</span>
                        </div>
                        <input type="range" min="0" max="100" value="60" id="hormonalSlider" oninput="updateCalculator()">
                        <small class="text-muted">Progesterone, estrogen, thyroid imbalance indicators</small>
                    </div>

                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Environmental Exposure (0-100) <span class="factor-weight">Weight: 20%</span></span>
                            <span class="slider-value" id="envValue">45</span>
                        </div>
                        <input type="range" min="0" max="100" value="45" id="envSlider" oninput="updateCalculator()">
                        <small class="text-muted">EDC exposure, heat stress, WASH access</small>
                    </div>

                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Micronutrient Status (0-100) <span class="factor-weight">Weight: 15%</span></span>
                            <span class="slider-value" id="microValue">70</span>
                        </div>
                        <input type="range" min="0" max="100" value="70" id="microSlider" oninput="updateCalculator()">
                        <small class="text-muted">Hemoglobin, B12, folate, ferritin levels (inverted)</small>
                    </div>

                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Social Support (0-100) <span class="factor-weight">Weight: 10%</span></span>
                            <span class="slider-value" id="socialValue">55</span>
                        </div>
                        <input type="range" min="0" max="100" value="55" id="socialSlider" oninput="updateCalculator()">
                        <small class="text-muted">Family support, community resources (inverted)</small>
                    </div>

                    <div class="text-center mt-4">
                        <button class="btn-calculate" onclick="calculateRisk()">
                            <i class="fas fa-calculator"></i> Calculate Risk Score
                        </button>
                    </div>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="result-card">
                    <h3 class="mb-3">PPD Risk Assessment Result</h3>
                    <div class="risk-score" id="riskScore">67</div>
                    <h4 id="riskLevel" class="risk-high">Moderate Risk</h4>
                    <p class="text-muted mt-3">Based on multi-factor AI analysis</p>

                    <div class="chart-container">
                        <canvas id="riskChart"></canvas>
                    </div>

                    <div class="mt-4">
                        <h5 class="mb-3">Automated Recommendations</h5>
                        <div id="recommendations">
                            <div class="recommendation-card">
                                <i class="fas fa-check-circle text-warning"></i> Schedule follow-up in 1 week
                            </div>
                            <div class="recommendation-card">
                                <i class="fas fa-check-circle text-warning"></i> Monitor EPDS score weekly
                            </div>
                            <div class="recommendation-card">
                                <i class="fas fa-check-circle text-warning"></i> Provide counseling support
                            </div>
                        </div>
                    </div>

                    <div class="mt-4">
                        <button class="btn btn-outline-primary" onclick="sendToASHA()">
                            <i class="fas fa-paper-plane"></i> Send Alert to ASHA Worker
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let riskChart;

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            initChart();
            calculateRisk();
        });

        function updateCalculator() {
            document.getElementById('epdsValue').textContent = document.getElementById('epdsSlider').value;
            document.getElementById('hormonalValue').textContent = document.getElementById('hormonalSlider').value;
            document.getElementById('envValue').textContent = document.getElementById('envSlider').value;
            document.getElementById('microValue').textContent = document.getElementById('microSlider').value;
            document.getElementById('socialValue').textContent = document.getElementById('socialSlider').value;
            
            // Auto-calculate on slider change
            calculateRisk();
        }

        function calculateRisk() {
            const epds = parseInt(document.getElementById('epdsSlider').value);
            const hormonal = parseInt(document.getElementById('hormonalSlider').value);
            const env = parseInt(document.getElementById('envSlider').value);
            const micro = parseInt(document.getElementById('microSlider').value);
            const social = parseInt(document.getElementById('socialSlider').value);

            // Calculate weighted risk score
            const riskScore = Math.round(
                (epds / 30 * 100) * 0.30 +
                hormonal * 0.25 +
                env * 0.20 +
                (100 - micro) * 0.15 +  // Inverted: lower nutrients = higher risk
                (100 - social) * 0.10    // Inverted: lower support = higher risk
            );

            // Update display
            const scoreElement = document.getElementById('riskScore');
            const levelElement = document.getElementById('riskLevel');
            scoreElement.textContent = riskScore;

            // Determine risk level and color
            let riskLevel, riskClass, recommendations;
            if (riskScore >= 80) {
                riskLevel = 'Critical Risk';
                riskClass = 'risk-critical';
                recommendations = [
                    '<i class="fas fa-exclamation-triangle text-danger"></i> Immediate psychiatric referral required',
                    '<i class="fas fa-user-nurse text-danger"></i> Daily monitoring by ASHA worker',
                    '<i class="fas fa-phone-alt text-danger"></i> Emergency support system activation',
                    '<i class="fas fa-users text-danger"></i> Family counseling session mandatory'
                ];
            } else if (riskScore >= 60) {
                riskLevel = 'High Risk';
                riskClass = 'risk-high';
                recommendations = [
                    '<i class="fas fa-calendar-check text-warning"></i> Schedule follow-up within 3 days',
                    '<i class="fas fa-chart-line text-warning"></i> Weekly EPDS monitoring',
                    '<i class="fas fa-comments text-warning"></i> Counseling support recommended',
                    '<i class="fas fa-flask text-warning"></i> Check micronutrient levels'
                ];
            } else if (riskScore >= 40) {
                riskLevel = 'Moderate Risk';
                riskClass = 'risk-moderate';
                recommendations = [
                    '<i class="fas fa-calendar text-info"></i> Schedule follow-up in 1 week',
                    '<i class="fas fa-heartbeat text-info"></i> Bi-weekly monitoring',
                    '<i class="fas fa-book text-info"></i> Provide educational materials',
                    '<i class="fas fa-user-friends text-info"></i> Encourage social support'
                ];
            } else {
                riskLevel = 'Low Risk';
                riskClass = 'risk-low';
                recommendations = [
                    '<i class="fas fa-check text-success"></i> Continue routine monitoring',
                    '<i class="fas fa-calendar-alt text-success"></i> Monthly check-ins',
                    '<i class="fas fa-heart text-success"></i> Maintain healthy lifestyle',
                    '<i class="fas fa-apple-alt text-success"></i> Regular nutritional assessment'
                ];
            }

            scoreElement.className = 'risk-score ' + riskClass;
            levelElement.textContent = riskLevel;
            levelElement.className = riskClass;

            // Update recommendations
            const recContainer = document.getElementById('recommendations');
            recContainer.innerHTML = recommendations.map(rec => 
                `<div class="recommendation-card">${rec}</div>`
            ).join('');

            // Update chart
            updateChart(epds/30*100, hormonal, env, 100-micro, 100-social);
        }

        function initChart() {
            const ctx = document.getElementById('riskChart').getContext('2d');
            riskChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['EPDS\n(30%)', 'Hormonal\n(25%)', 'Environmental\n(20%)', 'Micronutrients\n(15%)', 'Social\n(10%)'],
                    datasets: [{
                        label: 'Risk Factors',
                        data: [50, 60, 45, 30, 45],
                        backgroundColor: 'rgba(245, 158, 11, 0.2)',
                        borderColor: 'rgba(245, 158, 11, 1)',
                        borderWidth: 3,
                        pointBackgroundColor: 'rgba(245, 158, 11, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(245, 158, 11, 1)',
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function updateChart(epds, hormonal, env, micro, social) {
            if (riskChart) {
                riskChart.data.datasets[0].data = [epds, hormonal, env, micro, social];
                riskChart.update();
            }
        }

        function sendToASHA() {
            const riskScore = document.getElementById('riskScore').textContent;
            const riskLevel = document.getElementById('riskLevel').textContent;
            
            alert(`✅ Alert Sent to ASHA Worker!\n\nPatient Risk: ${riskLevel}\nRisk Score: ${riskScore}/100\n\nASHA worker will be notified via:\n• SMS notification\n• Dashboard alert\n• Mobile app push notification\n\nExpected response time: <15 minutes`);
        }
    </script>
</body>
</html>
